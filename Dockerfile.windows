# Local Build Dockerfile - Uses Windows Python to bypass network issues
FROM mcr.microsoft.com/windows/nanoserver:ltsc2022

# Set working directory
WORKDIR /app

# Copy Python files (assuming Python is available on host)
COPY . .

# For Windows containers, we'll use PowerShell
SHELL ["powershell", "-Command", "$ErrorActionPreference = 'Stop';"]

# Set environment variables
ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1

# Create a simple health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD powershell -Command "if (Test-Path 'C:\\app\\simple_container_agent.py') { exit 0 } else { exit 1 }"

# Default command
CMD ["powershell", "-Command", "python simple_container_agent.py"]